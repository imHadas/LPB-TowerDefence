# Default image (https://hub.docker.com/_/microsoft-dotnet-sdk)
image: mcr.microsoft.com/dotnet/sdk:6.0

stages:
  - build
  - test
#  - deploy

# Build
build_backend:
  stage: build
  script:
    - 'dotnet restore TowerDefence\TowerDefenceGame_LPB'
    - 'dotnet build TowerDefence\TowerDefenceGame_LPB -c Release'
  artifacts:
    expire_in: 2 days
    paths:
      - 'TowerDefence\TowerDefenceGame_LPB\bin\Release'

build_view:
  stage: build
  image: mcr.microsoft.com/dotnet/sdk:6.0-windowsservercore-ltsc2019
  tags: [windows]
  dependencies:
    - build_backend
  script:
    - 'dotnet restore TowerDefence\TowerDefenceWPF'
    - 'dotnet build TowerDefence\TowerDefenceWPF -c Release'
  

build_test:
  stage: build
  script:
    - 'dotnet restore TowerDefence\TowerDefence_Test'
    - 'dotnet build TowerDefence\TowerDefence_Test'
  artifacts:
    expire_in: 2 days
    paths:
      - 'TowerDefence\TowerDefence_Test\'

# Test
test_model:
  stage: test
  dependencies:
    - build_backend
    - build_test
  script:
    - 'dotnet test TowerDefence\TowerDefence_Test'
  artifacts:
    expire_in: 1 week
    paths:
      - '.\TestResult.xml'
